# Testing Guide - Stage 2

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ ‚úÖ

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `users` —Å–æ–∑–¥–∞–Ω–∞ –≤ `bot/data/db.sqlite3`
- ‚úÖ ORM —á–µ—Ä–µ–∑ `UserRepository` –≤ `bot/data/database.py`
- ‚úÖ –ü–æ–ª—è: id, tg_id, first_name, last_name, username, is_active, is_registered, last_response

### 2. –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
- ‚úÖ `/start` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
- ‚úÖ `/stop` - –æ—Ç–ø–∏—Å–∫–∞ –æ—Ç —Ä–∞—Å—Å—ã–ª–æ–∫

### 3. –ö–Ω–æ–ø–∫–∏ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
- ‚úÖ "–î–∞" / "–ù–µ—Ç" - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
- ‚úÖ "–î–∞, –±—É–¥—É" / "–ù–µ—Ç, –Ω–µ —Å–º–æ–≥—É" - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É—á–∞—Å—Ç–∏—è –≤–æ –≤—Å—Ç—Ä–µ—á–µ

### 4. –†–∞—Å—Å—ã–ª–∫–∏ (APScheduler)
- ‚úÖ –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ 10:00 –ú–°–ö - –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ –≤—Å—Ç—Ä–µ—á—É
- ‚úÖ –°—Ä–µ–¥–∞ 09:00 –ú–°–ö - –ø–µ—Ä–≤–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª)
- ‚úÖ –°—Ä–µ–¥–∞ 10:40 –ú–°–ö - –≤—Ç–æ—Ä–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª)

### 5. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ `config.yaml` —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –≤—Å—Ç—Ä–µ—á–∏
- ‚úÖ –¢–µ–º–∞, —Å—Å—ã–ª–∫–∞, –≤—Ä–µ–º—è, —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –±–æ—Ç–∞

```bash
cd /home/tomcat/projects/goryunova-live-bot
docker compose ps
docker compose logs --tail 20
```

–î–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å:
```
Bot starting...
Scheduler initialized with meeting notifications
Scheduled invitation: monday at 10:00 Europe/Moscow
Scheduled first reminder: wednesday at 09:00 Europe/Moscow
Scheduled second reminder: wednesday at 10:40 Europe/Moscow
```

### –®–∞–≥ 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã /start

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram: https://t.me/DEV_goryunova_live_bot
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
3. –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
   ```
   –ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç –¢–∞—Ç—å—è–Ω—ã –ì–æ—Ä—é–Ω–æ–≤–æ–π üòä
   –•–æ—á–µ—à—å –ø–æ–ª—É—á–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –Ω–∞ –≤—Å—Ç—Ä–µ—á–∏ –ø–æ —Å—Ä–µ–¥–∞–º?
   
   [–î–∞] [–ù–µ—Ç]
   ```

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

**–¢–µ—Å—Ç 3.1: –ù–∞–∂–∞—Ç—å "–î–∞"**
- –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: "–û—Ç–ª–∏—á–Ω–æ! –Ø –±—É–¥—É –ø—Ä–∏—Å—ã–ª–∞—Ç—å —Ç–µ–±–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è."
- –í –ë–î: `is_registered=True`

**–¢–µ—Å—Ç 3.2: –ù–∞–∂–∞—Ç—å "–ù–µ—Ç"**
- –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: "–•–æ—Ä–æ—à–æ! –ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è ‚Äî –¥–∞–π –∑–Ω–∞—Ç—å –∫–æ–º–∞–Ω–¥–æ–π /start."
- –í –ë–î: `is_registered=False`

### –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã /stop

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/stop`
2. –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: "–í—ã –æ—Ç–ø–∏—Å–∞–ª–∏—Å—å. –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å, –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã üôÇ"
3. –í –ë–î: `is_active=False`

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
cd /home/tomcat/projects/goryunova-live-bot
docker compose exec bot python3 -c "
from bot.data.database import user_repo
users = user_repo.get_all_registered_users()
for user in users:
    print(f'User {user.tg_id}: registered={user.is_registered}, active={user.is_active}, response={user.last_response}')
"
```

### –®–∞–≥ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–æ–∫ (—Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫)

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞—Å—Å—ã–ª–æ–∫ –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞/—Å—Ä–µ–¥—ã, –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤ `config.yaml`:

```yaml
schedule:
  invitation_day: "thursday"  # –¢–µ–∫—É—â–∏–π –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏
  invitation_time: "09:25"    # –í—Ä–µ–º—è —á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã
```

–ó–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å:
```bash
docker compose restart
docker compose logs -f
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ scheduler

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:
```bash
docker compose logs | grep "Scheduled"
```

–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
```
Scheduled invitation: monday at 10:00 Europe/Moscow
Scheduled first reminder: wednesday at 09:00 Europe/Moscow  
Scheduled second reminder: wednesday at 10:40 Europe/Moscow
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
goryunova-live-bot/
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py          # SQLite ORM
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ db.sqlite3           # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ start.py             # /start, /stop, callbacks
‚îÇ   ‚îú‚îÄ‚îÄ scheduler/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ notifications.py     # APScheduler —Ä–∞—Å—Å—ã–ª–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ logs/
‚îú‚îÄ‚îÄ config.py                     # –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ config.yaml                   # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Å—Ç—Ä–µ—á–∏
‚îú‚îÄ‚îÄ requirements.txt              # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ README.md
```

---

## Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
```bash
docker compose logs --tail 50
docker compose restart
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–∞–ø–∫–∞ `bot/data/` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏.

### Scheduler –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å:
```bash
docker compose exec bot python3 -c "
import pytz
from config import config
print(f'Timezone: {config[\"timezone\"]}')
tz = pytz.timezone(config['timezone'])
print(f'Current time: {tz.localize(pytz.datetime.datetime.now())}')
"
```

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
1. ‚úÖ –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ /start
2. ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
3. ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. ‚úÖ Scheduler –∑–∞–ø—É—â–µ–Ω
5. üìÖ –ñ–¥—ë–º –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏

**–≠—Ç–∞–ø 2 –≥–æ—Ç–æ–≤: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, —Ä–∞—Å—Å—ã–ª–∫–∏, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç.** ‚úÖ

